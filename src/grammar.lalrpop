use std::str::FromStr;
use crate::ast;

grammar;


pub Ident: ast::Ident = {
    r"[a-zA-Z_][0-9A-Za-z_]*" => ast::Ident(<>.to_string()),
};

Num: ast::Expr = {
    r"\d+" => {
        let num = <>.to_string().replace("_", "");
        ast::Expr::Num(i32::from_str(<>).unwrap())
    },
    r"[0-9]+d[0-9_]+" => {
        let num = <>.to_string().replace("_", "").splitn(2, 'd').nth(1).unwrap().to_string();
        ast::Expr::Num(i32::from_str_radix(&num, 10).unwrap())
    },
    r"[0-9]+b[01_]+" => {
        let num = <>.to_string().replace("_", "").splitn(2, 'b').nth(1).unwrap().to_string();
        ast::Expr::Num(i32::from_str_radix(&num, 2).unwrap())
    },
    r"[0-9]+x[0-9a-fA-F_]+" => {
        let num = <>.to_string().replace("_", "").splitn(2, 'x').nth(1).unwrap().to_string();
        ast::Expr::Num(i32::from_str_radix(&num, 16).unwrap())
    },
};


pub Func: ast::Func = {
  "fn" <fname:Ident> "(" ")" "{" <stmts:StatementList> "}" => ast::Func(fname,
  stmts)
}

StatementList: Vec<ast::Statement> = {
  <stmts:(Statement ";")*> => stmts.into_iter().map(|(stmt, s)| stmt).collect()
}

Statement: ast::Statement = {
  "()" => ast::Statement::Empty
}
